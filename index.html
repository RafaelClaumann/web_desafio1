<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Cadastro de Veículo</title>
  </head>

  <body>
    <form>
      <fieldset>
        <legend>Dados do Proprietário</legend>
        <label>Nome do proprietário:</label>
        <input type="text" name="nome_proprietario" required />
      </fieldset>

      <fieldset>
        <legend>Dados do Veículo</legend>
        <label>Placa do veículo:</label>
        <input type="text" name="placa_veiculo" required />

        <label>Modelo do veículo:</label>
        <input type="text" name="modelo_veiculo" required />

        <label>Cor do veículo:</label>
        <input type="text" name="cor_veiculo" required />
      </fieldset>

      <fieldset>
        <legend>Dados do Apartamento</legend>

        <label
          >Bloco do apartamento:
          <select
            id="bloco"
            name="bloco_apartamento"
            required
            onchange="liberarApartamento()"
          >
            <option value="">Selecione...</option>
          </select>
        </label>

        <label
          >Número do apartamento:
          <select
            id="apartamento"
            name="numero_apartamento"
            required
            disabled
            onchange="liberarVaga()"
          >
            <option value="">Selecione...</option>
          </select>
        </label>

        <label
          >Número da vaga de estacionamento:
          <select id="vaga" name="vaga_estacionamento" required disabled>
            <option value="">Selecione...</option>
          </select>
        </label>
      </fieldset>
      <input type="submit" value="Enviar" />
    </form>
    <script>
      const blocos = {
        A: [
          { numero_apto: 101, numero_vaga: 111, ocupada: true },
          { numero_apto: 101, numero_vaga: 222, ocupada: false },
          { numero_apto: 103, numero_vaga: 333, ocupada: false },
          { numero_apto: 104, numero_vaga: 444, ocupada: false },
        ],
        B: [
          { numero_apto: 404, numero_vaga: 4, ocupada: false },
          { numero_apto: 422, numero_vaga: 2, ocupada: false },
          { numero_apto: 409, numero_vaga: 9, ocupada: false },
        ],
      };

      function liberarApartamento() {
        var comboAparamento = document.getElementById("apartamento");
        var comboVaga = document.getElementById("vaga");

        comboAparamento.disabled = true;
        comboVaga.disabled = true;

        if (document.getElementById("bloco").value) {
          comboAparamento.disabled = false;
          preencherComboApartamentos();
          return;
        }
      }

      function liberarVaga() {
        var comboVaga = document.getElementById("vaga");
        comboVaga.disabled = true;

        if (document.getElementById("apartamento").value) {
          comboVaga.disabled = false;
          preencherComboVagas();
          return;
        }
      }

      function preencherComboBlocos() {
        const comboBlocoId = "bloco";
        clearComboBox(comboBlocoId);

        Object.keys(blocos).forEach((blocoKey) => {
          const option = document.createElement("option");
          option.value = blocoKey;
          option.textContent = "Bloco " + blocoKey;

          document.getElementById(comboBlocoId).appendChild(option);
        });
      }

      function preencherComboApartamentos() {
        const comboApartamendoId = "apartamento";
        clearComboBox(comboApartamendoId);

        const blocoSelecionado = document.getElementById("bloco").value;
        const numerosApartamentos = blocos[blocoSelecionado].map(
          (apto) => apto.numero_apto
        );
        const apartamentosUnicos = [...new Set(numerosApartamentos)];

        apartamentosUnicos.forEach((numero_apto) => {
          const option = document.createElement("option");
          option.value = numero_apto;
          option.textContent = "Apartamento " + option.value;

          document.getElementById(comboApartamendoId).appendChild(option);
        });
      }

      function preencherComboVagas() {
        const comboVagaId = "vaga";
        clearComboBox(comboVagaId);

        const blocoSelecionado = document.getElementById("bloco").value;
        const apartamentoSelecionado =
          document.getElementById("apartamento").value;

        blocos[blocoSelecionado]
          .filter((apto) => apto.numero_apto == apartamentoSelecionado)
          .forEach((apto) => {
            const option = document.createElement("option");
            option.value = apto.numero_vaga;
            option.textContent = "Vaga " + option.value;

            document.getElementById(comboVagaId).appendChild(option);
          });
      }

      function clearComboBox(idComboBox) {
        var comboBox = document.getElementById(idComboBox);
        while (comboBox.options.length > 1) {
          comboBox.remove(1);
        }
      }

      document.addEventListener("DOMContentLoaded", preencherComboBlocos);
    </script>
  </body>
</html>
